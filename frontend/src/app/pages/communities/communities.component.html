<!-- HEADER + BOTÓN -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">Comunidades registradas</h2>
  <button class="btn btn-success" (click)="openModal('modalNewCommunity')">
    Añadir comunidad
  </button>
</div>

<!-- BUSCADOR -->
<div class="container py-4">
  <div class="mb-3">
    <input type="text" name= "buscador" class="form-control" [(ngModel)]="filtro" placeholder="Buscar comunidad por calle...">
  </div>

  <!-- TABLA -->
  <table class="table table-hover">
    <thead class="table-primary">
      <tr>
        <th>Dirección</th>
        <th>Código Postal</th>
        <th>Nº Propiedades</th>
        <th>Más info</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let community of getFilteredCommunities()">
        <td>{{ community.address }}</td>
        <td>{{ community.postalCode }}</td>
        <td>{{ community.propertiesCount }}</td>
        <td>
          <button class="btn btn-sm btn-outline-info me-1" (click)="verComunidad(community.id)">Ver</button>
          <button class="btn btn-sm btn-outline-secondary">Editar</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div *ngIf="selectedCommunity" class="card mt-4 p-3 shadow-sm">
  <h4>Detalles de la comunidad</h4>
  <p><strong>Dirección:</strong> {{ selectedCommunity.address }}</p>
  <p><strong>Código Postal:</strong> {{ selectedCommunity.postalCode }}</p>
  <p><strong>Ascensor:</strong> {{ selectedCommunity.elevator ? 'Sí' : 'No' }}</p>
  <p><strong>Nº Plantas:</strong> {{ selectedCommunity.numFlats }}</p>
  <p><strong>Parkings:</strong> {{ selectedCommunity.numparkings }}</p>
  <p><strong>Trasteros:</strong> {{ selectedCommunity.numStorageRooms }}</p>
  <p><strong>Acceso movilidad reducida:</strong> {{ selectedCommunity.reducedMobilityAccess ? 'Sí' : 'No' }}</p>
  <p><strong>Número de cuenta:</strong> {{ selectedCommunity.bankAccountNumber }}</p>

  <button class="btn btn-outline-primary mt-3" (click)="toggleProperties()">
    {{ showProperties ? 'Ocultar propiedades' : 'Ver propiedades' }}
  </button>

  <div *ngIf="showProperties" class="mt-3">
    <h5>Propiedades</h5>
    <p>(Aquí podrías listar las propiedades si las incluyes más adelante)</p>
  </div>
</div>


<!-- MODAL DE NUEVA COMUNIDAD -->
<div class="modal fade" id="modalNewCommunity" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Nueva comunidad</h5>
        <button type="button" class="btn-close" (click)="cerrarModal('modalNewCommunity')" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body">
        <form (ngSubmit)="addCommunity()">
          <div class="mb-3">
            <label for="address" class="form-label">Dirección</label>
            <input type="text" id="address" name="address" class="form-control" [(ngModel)]="newCommunity.address" required>
          </div>

          <div class="mb-3">
            <label for="postalCode" class="form-label">Código Postal</label>
            <input type="text" id="postalCode" name="postalCode" class="form-control" [(ngModel)]="newCommunity.postalCode" required>
          </div>

          <div class="mb-3">
            <label for="elevator" class="form-label">Ascensor</label>
            <select id="elevator" name="elevator" class="form-control" [(ngModel)]="newCommunity.elevator">
              <option [ngValue]="true">Sí</option>
              <option [ngValue]="false">No</option>
            </select>
          </div>

          <div class="mb-3">
            <label for="numFlats" class="form-label">Número de Plantas</label>
            <input type="number" id="numFlats" name="numFlats" class="form-control" [(ngModel)]="newCommunity.numFlats" required min="0">
          </div>

          <div class="mb-3">
            <label for="numparkings" class="form-label">Número de Parkings</label>
            <input type="number" id="numparkings" name="numparkings" class="form-control" [(ngModel)]="newCommunity.numparkings" required min="0">
          </div>

          <div class="mb-3">
            <label for="numStorageRooms" class="form-label">Número de Trasteros</label>
            <input type="number" id="numStorageRooms" name="numStorageRooms" class="form-control" [(ngModel)]="newCommunity.numStorageRooms" required min="0">
          </div>

          <div class="mb-3">
            <label for="reducedMobilityAccess" class="form-label">Acceso Movilidad Reducida</label>
            <select id="reducedMobilityAccess" name="reducedMobilityAccess" class="form-control" [(ngModel)]="newCommunity.reducedMobilityAccess">
              <option [ngValue]="true">Sí</option>
              <option [ngValue]="false">No</option>
            </select>
          </div>

          <!-- Cuenta Bancaria (Opcional) -->
          <div class="mb-3">
            <label for="bankAccount" class="form-label">Número de Cuenta Bancaria</label>
            <input type="text" id="bankAccount" name="bankAccount" class="form-control" [(ngModel)]="newCommunity.bankAccountNumber">
          </div>
          <div *ngIf="isLoading" class="spinner-border text-primary" role="status">
          <span class="sr-only">Cargando...</span>
          </div>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </form>
      </div>

    </div>
  </div>
</div>

<!-- MODAL DE DETALLES DE LA COMUNIDAD -->
<div class="modal fade" id="modalCommunityDetails" tabindex="-1" aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabel">Detalles de la Comunidad</h5>
        <button type="button" class="btn-close" (click)="cerrarModal('modalCommunityDetails')" aria-label="Cerrar"></button>
      </div>
      
      <div class="modal-body">
        <div *ngIf="selectedCommunity">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">{{ selectedCommunity.address }}</h5>
              <p class="card-text"><strong>Código Postal:</strong> {{ selectedCommunity.postalCode }}</p>
              <p class="card-text"><strong>Ascensor:</strong> {{ selectedCommunity.elevator ? 'Sí' : 'No' }}</p>

               <!-- Añadimos los botones "Ver" a continuación de los campos -->
              <div class="d-flex justify-content-between">
                <span><strong>Nº Viviendas:</strong> {{ selectedCommunity.numFlats }}</span>
                <button class="btn btn-outline-info btn-sm" (click)="verMasDetalles('flats')">Ver</button>
              </div>
              
              <div class="d-flex justify-content-between">
                <span><strong>Parkings:</strong> {{ selectedCommunity.numparkings }}</span>
                <button class="btn btn-outline-info btn-sm" (click)="verMasDetalles('parkings')">Ver</button>
              </div>

              <div class="d-flex justify-content-between">
                <span><strong>Trasteros:</strong> {{ selectedCommunity.numStorageRooms }}</span>
                <button class="btn btn-outline-info btn-sm" (click)="verMasDetalles('trasteros')">Ver</button>
              </div>
              
              <p class="card-text"><strong>Acceso movilidad reducida:</strong> {{ selectedCommunity.reducedMobilityAccess ? 'Sí' : 'No' }}</p>
              <p class="card-text"><strong>Número de cuenta:</strong> {{ selectedCommunity.bankAccountNumber }}</p>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cerrarModal('modalCommunityDetails')">Cerrar</button>
      </div>
    </div>
  </div>
</div>

